
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Javascript API Reference</title>

    <link href="stylesheets/screen.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="stylesheets/print.css" media="print" rel="stylesheet" type="text/css" />
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="javascripts/all.js" type="text/javascript"></script>

    <script>
      $(function() {
        var toc = $("#toc").tocify({
          selectors: "h1,h2",
          extendPage: false,
          theme: "none",
          smoothScroll: false,
          showEffectSpeed: 0,
          hideEffectSpeed: 180,
          ignoreSelector: ".toc-ignore",
          hashGenerator: 'pretty',
          highlightOffset: 60,
          scrollTo: -2,
          scrollHistory: true,
          hashGenerator: function(text, element) {
            return element[0].getAttribute('id');
          }
        }).data("toc-tocify");
        // Hack to make already open sections to start opened,
        // instead of displaying an ugly animation
        setTimeout(function() {
          toc.setOption("showEffectSpeed", 180);
        },50);
        setupLanguages([
          
            
              
                'javascript',
              
            
          
        ]);
      });
    </script>
  </head>

  <body class="js">
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
      <div id="toc">
      </div>
      
      <ul class="toc-footer">
        
          <li><a href='https://publitas.com'>Publitas.com</a></li>
        
          <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        
      </ul>
      
    </div>
    <div class="page-wrapper">
      <div class="content">
        <h1 id="javascript-api-v1.0">JavaScript API v1.0</h1>

<p>This API can be used to customize some behaviors in the Publitas.com Viewer.</p>

<h2 id="getting-started">Getting Started</h2>
<pre class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">viewerReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">platform</span><span class="p">)</span>
<span class="p">};</span>
</pre>
<p>To access the Publitas.com JavaScript API you need to inject JavaScript code into the Viewer. This can be achieved using the code injection field in your group or publication settings. The basic usage is shown to the right. Please make sure to wrap it in a <code class="prettyprint">&lt;script&gt;</code> tag when setting it in the header.</p>

<p>The arguments passed to this function are</p>

<ul>
<li><code class="prettyprint">api</code>, an object exposing the API methods</li>
<li><code class="prettyprint">platform</code>, a string specifying the current device category. Can be <em>desktop</em>, <em>tablet</em> or <em>mobile</em></li>
</ul>

<h2 id="targeting-different-devices">Targeting Different Devices</h2>
<pre class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">viewerReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s2">"desktop"</span><span class="err">:</span>
      <span class="c1">// desktop only customizations here
</span>      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">"tablet"</span><span class="err">:</span>
      <span class="c1">// tablet only customizations here
</span>      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">"mobile"</span><span class="err">:</span>
      <span class="c1">// mobile only customizations here
</span>      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre>
<p>By default, customizations are applied to all device categories. This example shows how you could use the <code class="prettyprint">platform</code> parameter to implement different customizations depending on the device the Viewer is running on.</p>

<h2 id="custom-home-button-action">Custom Home Button Action</h2>
<pre class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">viewerReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">setHomeButtonAction</span><span class="p">(</span><span class="s2">"http://your.custom.url"</span><span class="p">,</span> <span class="s2">"custom title"</span><span class="p">);</span>

  <span class="c1">// or
</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">setHomeButtonAction</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// do something here
</span>  <span class="p">},</span> <span class="s2">"custom title"</span><span class="p">);</span>
<span class="p">}</span>
</pre>
<p>Using the <code class="prettyprint">setHomeButtonAction(action [, title])</code> you can specify a custom action when the user clicks the home button in the main menu. <code class="prettyprint">action</code> can be a URL string or a function. <code class="prettyprint">title</code> is an optional string argument, that sets the home button title.</p>

<h2 id="custom-shopping-cart-button-action">Custom Shopping Cart Button Action</h2>
<pre class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">viewerReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">setCartButtonAction</span><span class="p">(</span><span class="s2">"http://your.custom.url"</span><span class="p">,</span> <span class="s2">"custom title"</span><span class="p">);</span>

  <span class="c1">// or
</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">setCartButtonAction</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// do something here
</span>  <span class="p">},</span> <span class="s2">"custom title"</span><span class="p">);</span>
<span class="p">}</span>
</pre>
<p>Using the <code class="prettyprint">setCartButtonAction(action [, title])</code> you can specify a custom action when the user clicks the shopping cart button in the main menu. <code class="prettyprint">action</code> can be a URL string or a function. <code class="prettyprint">title</code> is an optional string argument, that sets the cart button title.</p>

<h2 id="updating-the-shopping-cart-icon">Updating the shopping cart icon</h2>
<pre class="highlight javascript"><span class="nx">api</span><span class="p">.</span><span class="nx">cartContentChanged</span><span class="p">({</span> <span class="na">numItems</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">num</span><span class="o">-</span><span class="nx">items</span><span class="o">&gt;</span> <span class="p">})</span>
</pre>
<p>The shopping cart icon can display the number of items currently in the cart, using the cartContentChange method.</p>

<p>The appearance of the shopping cart icon will change from &lsquo;empty&rsquo; to &lsquo;full&rsquo; if there are more than 0 items in the cart. To change the cart to empty again, set numItems to 0.</p>

<h3 id="updating-the-shopping-cart-from-an-iframe">Updating the shopping cart from an iframe</h3>
<pre class="highlight javascript"><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="s1">'cartContentChanged'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">numItems</span><span class="p">:</span> <span class="nx">numItems</span>
<span class="p">}]),</span> <span class="s2">"*"</span><span class="p">);</span>

</pre>
<p>If you use an iframe (check <a href="#showing-external-content-in-an-iframe">the section</a> on iframes) and you need to update the shopping cart icon from within the iframed content, you can use the <code class="prettyprint">postMessage</code> as shown to the left.</p>

<p>The message consists of an array, but because IE 8 &amp; 9 only support sending string messages, it needs to be serialized using <code class="prettyprint">JSON.stringify</code>.</p>

<p>The second parameter to postMessage controls the target origin the parent window should have to receive the message. Using <code class="prettyprint">&quot;*&quot;</code> is a good default, but you can implement a more restrictive policy. Check <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage">the postMessage documentation</a> for more details.</p>

<h2 id="showing-external-content-in-an-iframe">Showing external content in an iframe</h2>
<pre class="highlight javascript">
<span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">width</span><span class="p">:</span> <span class="s1">'800px'</span><span class="p">,</span>
  <span class="na">background</span><span class="p">:</span> <span class="s1">'#ffffff'</span>
<span class="p">};</span>

<span class="nx">api</span><span class="p">.</span><span class="nx">showExternalContent</span><span class="p">(</span><span class="s1">'http://some.url'</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</pre>
<p>Using the <code class="prettyprint">showExternalContent(url [, options])</code>  method, you can display custom content in a popover (or sliding panel on mobile). This is commonly used for showing a custom product details page in combination with setProductAction described below.</p>

<p>The first parameter is a URL string and the second an optional object with options. Supported options are</p>

<ul>
<li><code class="prettyprint">width</code>, a css string to set the width of the iframe. Default is <code class="prettyprint">&#39;800px&#39;</code></li>
<li><code class="prettyprint">background</code>, a css string to set the background color of the popover. You can use this to match the background color of your content. Default is <code class="prettyprint">&#39;#ffffff&#39;</code></li>
</ul>

<h3 id="callbacks">callbacks</h3>
<pre class="highlight javascript"><span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">showExternalContent</span><span class="p">(</span><span class="s1">'http://some.url'</span><span class="p">);</span>

<span class="nx">content</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'close'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// do something when the iframe closes
</span><span class="p">});</span>
</pre>
<p><code class="prettyprint">showExternalContent</code> returns a proxy on which you can register event listeners. The only supported event at the moment is <code class="prettyprint">close</code> which gets triggered whenever the user closes the iframe. The syntax is shown in the second example on the right. For a full use case, check the next section on setting custom product actions.</p>

<h2 id="custom-product-action">Custom Product Action</h2>
<pre class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">viewerReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">setProductAction</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">products</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something here
</span>  <span class="p">});</span>
<span class="p">}</span>
</pre>
<p>Using the <code class="prettyprint">setProductAction(action [, onOpen[, onClose]])</code> you can specify a custom action when the user clicks on a product on the Viewer. <code class="prettyprint">action</code> needs to be a function. It will receive the an array of products that belong to the clicked hotspot as an argument. Products have the following properties:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Integer</td>
<td>Product id</td>
</tr>
<tr>
<td>hotspotId</td>
<td>Integer</td>
<td>Id of the related hotspot</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>Product title</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Product description</td>
</tr>
<tr>
<td>price</td>
<td>Float</td>
<td>Product price</td>
</tr>
<tr>
<td>webshopIdentifier</td>
<td>String</td>
<td>Product id from the webshop</td>
</tr>
<tr>
<td>webshopUrl</td>
<td>String</td>
<td>Direct link to the product on the webshop</td>
</tr>
<tr>
<td>photos</td>
<td>Array</td>
<td>Array of product photos containing 0 - 6 photos</td>
</tr>
<tr>
<td>video</td>
<td>Object</td>
<td>Object with property &lsquo;youtubeId&rsquo; if product has a YouTube video</td>
</tr>
</tbody></table>

<h3 id="onopen-and-onclose"><code class="prettyprint">onOpen</code> and <code class="prettyprint">onClose</code></h3>
<pre class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">viewerReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">setProductAction</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">products</span><span class="p">,</span> <span class="nx">onOpen</span><span class="p">,</span> <span class="nx">onClose</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="p">...;</span> <span class="c1">// create a URL based on products
</span>
    <span class="nx">onOpen</span><span class="p">();</span> <span class="c1">// update the address bar and browser title
</span>
    <span class="c1">// show custom product page
</span>    <span class="nx">api</span><span class="p">.</span><span class="nx">showExternalContent</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span><span class="na">width</span><span class="p">:</span> <span class="s1">'600px'</span><span class="p">})</span>
      <span class="c1">// revert the address bar and browser title once iframe is closed
</span>      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'close'</span><span class="p">,</span> <span class="nx">onClose</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre>
<p>These are optional callbacks that you can evoke if you are implementing a custom product popover. The default behavior of the catalog viewer is to update the address bar URL to</p>

<p><em>http://url.of/your/publication/product/&lt;product-id&gt;</em></p>

<p>whenever the product view opens. This way, users can directly link to a product within the catalog and refreshing the page will leave the product view intact. If you want to keep this behavior for your custom product action, please make sure to invoke these callbacks at appropriate times. The second example to the right highlights this use case.</p>

<h2 id="custom-product-cta">Custom Product CTA</h2>
<pre class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">viewerReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">setProductCtaAction</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something here
</span>  <span class="p">});</span>
<span class="p">}</span>
</pre>
<p>Using the <code class="prettyprint">setProductCtaAction(action)</code> you can specify a custom action when the user clicks the &lsquo;Go To Webshop&rsquo; button (call to action) in the product details view. <code class="prettyprint">action</code> needs to be a function. It will receive the corresponding product as argument (same as <code class="prettyprint">setProductAction</code>).</p>

<h2 id="custom-link-action">Custom Link Action</h2>
<pre class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">viewerReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">setLinkAction</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something here
</span>  <span class="p">});</span>
<span class="p">}</span>
</pre>
<p>Using the <code class="prettyprint">setLinkAction(action)</code> you can specify a custom action when the user clicks on an external link in the Viewer. <code class="prettyprint">action</code> needs to be a function. It will receive the original URL as an argument.</p>

      </div>
      <div class="dark-box">
        <div id="lang-selector">
          
            
              
                <a href="#" data-language-name="javascript">javascript</a>
              
            
          
        </div>
      </div>
    </div>
  </body>
</html>